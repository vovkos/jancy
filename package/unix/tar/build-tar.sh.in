#!/bin/bash
#...............................................................................
#
#  This file is part of the Jancy toolkit.
#
#  Jancy is distributed under the MIT license.
#  For details see accompanying license.txt file,
#  the public copy of which is also available at:
#  http://tibbo.com/downloads/archive/jancy/license.txt
#
#...............................................................................

set -e

ROOT_DIR=${JANCY_ROOT_DIR}
OUT_DIR=${JANCY_PACKAGE_DIR}
TAR_DIR=${CMAKE_CURRENT_BINARY_DIR}/tar
TAR_SUB_DIR=jancy-${JANCY_VERSION_FILE_SUFFIX}
CONTENTS_DIR=$TAR_DIR/$TAR_SUB_DIR
OUT_FILE_NAME=jancy-src-${JANCY_VERSION_FILE_SUFFIX}.tar.xz
OUT_FILE_PATH=$OUT_DIR/$OUT_FILE_NAME

echo Building archive $OUT_FILE_NAME...

rm -rf $TAR_DIR
rm -f $OUT_FILE_PATH

mkdir -p $CONTENTS_DIR/cmake
mkdir -p $CONTENTS_DIR/doc
mkdir -p $CONTENTS_DIR/license
mkdir -p $CONTENTS_DIR/include
mkdir -p $CONTENTS_DIR/src
mkdir -p $CONTENTS_DIR/samples
mkdir -p $CONTENTS_DIR/test
mkdir -p $CONTENTS_DIR/package
mkdir -p $OUT_DIR

cp -f $ROOT_DIR/cmake/* $CONTENTS_DIR/cmake
cp -rf $ROOT_DIR/doc $CONTENTS_DIR
cp -rf $ROOT_DIR/license $CONTENTS_DIR
cp -f $ROOT_DIR/include/* $CONTENTS_DIR/include
cp -rf $ROOT_DIR/src $CONTENTS_DIR
cp -rf $ROOT_DIR/samples $CONTENTS_DIR
cp -rf $ROOT_DIR/test $CONTENTS_DIR
cp -rf $ROOT_DIR/package $CONTENTS_DIR
cp -f $ROOT_DIR/* $CONTENTS_DIR

rm -f $CONTENTS_DIR/.git*
rm -f $CONTENTS_DIR/*.user
rm -f $CONTENTS_DIR/paths.cmake

chown -R root:$(id -gn root) $TAR_DIR
tar -cJf $OUT_FILE_PATH -C $TAR_DIR $TAR_SUB_DIR
rm -rf $TAR_DIR
