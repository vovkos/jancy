int main() {
	printf("compiling\n");

	jnc.Regex regex;
	regex.createSwitch();
	regex.compileSwitchCase(r"\x02[^\r]+\r");
	regex.compileSwitchCase(r"[a-z]+");
	regex.compileSwitchCase(r"[0-9]+");
	regex.compileSwitchCase(r".");
	regex.finalizeSwitch();

	printf("matching\n");

	char const* text = "\x02zab123cdef45678!";

	jnc.RegexExecResult result;
	jnc.RegexState state(jnc.RegexExecFlags.AnchorDataBegin | jnc.RegexExecFlags.Stream);

	result = regex.exec(state, text);	
	assert(result == jnc.RegexExecResult.Continue);

	result = regex.eof(state, true);
	assert(result == jnc.RegexExecResult.Match);
	printf("match id: %d, offset: %d, length: %d, text: %s\n", state.m_matchAcceptId, state.m_match.m_offset, state.m_match.m_length, state.m_match.m_text);

	for (size_t i = 0; i < 5; i++) {
		result = regex.exec(state, text + state.m_match.m_endOffset);
		assert(result == jnc.RegexExecResult.Match); // eof shouldn't be required here
		printf("match id: %d, offset: %d, length: %d, text: %s\n", state.m_matchAcceptId, state.m_match.m_offset, state.m_match.m_length, state.m_match.m_text);
	}

	return 0;

catch:
	printf($"error: $!\n");
	return -1;
}
